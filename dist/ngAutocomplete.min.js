"use strict";angular.module("ngAutocomplete",[]).directive("ngAutocomplete",function(){return{require:"ngModel",scope:{ngModel:"=",options:"=?",details:"=?"},link:function(e,t,n,o){var i,s=!1,a=!1,c=function(){i={},e.options&&(e.options.watchEnter===!0&&(s=!0),e.options.types?(i.types=[],i.types.push(e.options.types),e.gPlace.setTypes(i.types)):e.gPlace.setTypes([]),e.options.bounds?(i.bounds=e.options.bounds,e.gPlace.setBounds(i.bounds)):e.gPlace.setBounds(null),e.options.country?(i.componentRestrictions={country:e.options.country},e.gPlace.setComponentRestrictions(i.componentRestrictions)):e.gPlace.setComponentRestrictions(null),e.options.strict?i.strict=e.options.strict:i.strict=!1),t.attr("required")&&(a=!0)};void 0==e.gPlace&&(e.gPlace=new google.maps.places.Autocomplete(t[0],{})),google.maps.event.addListener(e.gPlace,"place_changed",function(){var n=e.gPlace.getPlace();void 0!==n&&(void 0!==n.address_components?e.$apply(function(){e.details=n,o.$setViewValue(t.val()),o.$setValidity("invalidAddress",!0)}):s&&l(n,function(){o.$setValidity("invalidAddress",!0)}))});var l=function(n,s){var a=new google.maps.places.AutocompleteService;n.name.length>0&&a.getPlacePredictions({input:n.name,offset:n.name.length},function(n,a){if(null==n||0==n.length)e.$apply(function(){e.details=null}),"function"==typeof s&&s();else if(i.strict){var c=new google.maps.places.PlacesService(t[0]);c.getDetails({placeId:n[0].place_id},function(n,i){i==google.maps.GeocoderStatus.OK&&e.$apply(function(){o.$setViewValue(n.formatted_address),t.val(n.formatted_address),e.details=n,t.on("focusout",function(e){t.val(n.formatted_address),t.unbind("focusout")}),"function"==typeof s&&s()})})}else{var l=n[0].description;e.$apply(function(){o.$setViewValue(l),t.val(l),t.on("focusout",function(e){t.unbind("focusout"),setTimeout(function(){t.val(l)},100)}),"function"==typeof s&&s()})}})};o.$render=function(){var e=o.$viewValue;t.val(e)},e.watchOptions=function(){return e.options},e.$watch(e.watchOptions,function(){c()},!0),e.$watch(function(){return o.$modelValue},function(e,t){if("undefined"==typeof t&&t!=e){if(e.length>2){var n={name:e};l(n,function(){o.$setValidity("invalidAddress",!0)})}}else a&&("undefined"==typeof e||!e||e.length<t.length||e.length<2)&&o.$setValidity("invalidAddress",!1)})}}});